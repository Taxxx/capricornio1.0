/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * FrmCambiarPassw.java
 *
 * Created on 24-mar-2011, 14:38:25
 */

package umsa.capricornio.gui.menu;

import java.awt.event.KeyEvent;
import java.rmi.RemoteException;
import java.util.Map;
import javax.xml.rpc.ServiceException;
import umsa.capricornio.gui.ConnectADQUI.AdquiWSServiceLocator;
import umsa.capricornio.gui.ConnectADQUI.AdquiWS_PortType;

/**
 *
 * @author julian
 */
public class FrmCambiarPassw extends javax.swing.JInternalFrame {
    FrmMenu menu;
    private Runtime r;
    int cod_usuario;
    /** Creates new form FrmCambiarPassw */
    public FrmCambiarPassw(FrmMenu menu,int cod_usuario) {
        this.menu=menu;
        this.cod_usuario=cod_usuario;
        initComponents();
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        PswActual = new javax.swing.JPasswordField();
        PswNuevo = new javax.swing.JPasswordField();
        PswRepiteNuevo = new javax.swing.JPasswordField();
        jLabel2 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        BtnAceptar = new javax.swing.JButton();
        BtnCancelar = new javax.swing.JButton();

        setBackground(new java.awt.Color(232, 242, 251));
        getContentPane().setLayout(null);

        jPanel1.setBackground(new java.awt.Color(164, 187, 210));
        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("Cambiar Password"));
        jPanel1.setLayout(null);

        jLabel3.setFont(new java.awt.Font("Arial", 1, 11)); // NOI18N
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel3.setText("Repetir Nuevo Password :");
        jPanel1.add(jLabel3);
        jLabel3.setBounds(30, 110, 142, 20);

        PswActual.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                PswActualKeyPressed(evt);
            }
        });
        jPanel1.add(PswActual);
        PswActual.setBounds(180, 30, 150, 20);

        PswNuevo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                PswNuevoKeyPressed(evt);
            }
        });
        jPanel1.add(PswNuevo);
        PswNuevo.setBounds(180, 70, 150, 20);

        PswRepiteNuevo.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                PswRepiteNuevoKeyPressed(evt);
            }
        });
        jPanel1.add(PswRepiteNuevo);
        PswRepiteNuevo.setBounds(180, 110, 150, 20);

        jLabel2.setFont(new java.awt.Font("Arial", 1, 11)); // NOI18N
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel2.setText("Nuevo Password :");
        jPanel1.add(jLabel2);
        jLabel2.setBounds(40, 70, 130, 20);

        jLabel1.setFont(new java.awt.Font("Arial", 1, 11)); // NOI18N
        jLabel1.setHorizontalAlignment(javax.swing.SwingConstants.RIGHT);
        jLabel1.setText("Password actual :");
        jPanel1.add(jLabel1);
        jLabel1.setBounds(40, 30, 130, 20);

        getContentPane().add(jPanel1);
        jPanel1.setBounds(10, 10, 360, 150);

        BtnAceptar.setFont(new java.awt.Font("Arial", 1, 11)); // NOI18N
        BtnAceptar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/umsa/capricornio/gui/images/accept.png"))); // NOI18N
        BtnAceptar.setText("Aceptar");
        BtnAceptar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BtnAceptarActionPerformed(evt);
            }
        });
        getContentPane().add(BtnAceptar);
        BtnAceptar.setBounds(50, 170, 120, 25);

        BtnCancelar.setFont(new java.awt.Font("Arial", 1, 11)); // NOI18N
        BtnCancelar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/umsa/capricornio/gui/images/cancel.png"))); // NOI18N
        BtnCancelar.setText("Cancelar");
        BtnCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BtnCancelarActionPerformed(evt);
            }
        });
        getContentPane().add(BtnCancelar);
        BtnCancelar.setBounds(220, 170, 120, 25);

        setBounds(0, 0, 393, 231);
    }// </editor-fold>//GEN-END:initComponents

    private void PswActualKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_PswActualKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER )  {
            PswNuevo.requestFocus();
        }
    }//GEN-LAST:event_PswActualKeyPressed

    private void PswNuevoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_PswNuevoKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER )  {
            PswRepiteNuevo.requestFocus();
        }
    }//GEN-LAST:event_PswNuevoKeyPressed

    private void PswRepiteNuevoKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_PswRepiteNuevoKeyPressed
        if(evt.getKeyCode() == KeyEvent.VK_ENTER )  {
            BtnAceptar.requestFocus();
        }
    }//GEN-LAST:event_PswRepiteNuevoKeyPressed

    private void BtnCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BtnCancelarActionPerformed
        menu.CerrarFrameInterno(this);
        System.gc();
        r = Runtime.getRuntime();
        long mem1 = r.freeMemory();
    }//GEN-LAST:event_BtnCancelarActionPerformed

    private void BtnAceptarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BtnAceptarActionPerformed
        if (!(PswNuevo.getText().equals(PswRepiteNuevo.getText()))) {
            javax.swing.JOptionPane.showMessageDialog(this,"Los passwords nuevos son diferentes","Cambio Pass",
            javax.swing.JOptionPane.ERROR_MESSAGE);
            PswActual.setText("");
            PswNuevo.setText("");
            PswRepiteNuevo.setText("");
            PswActual.requestFocus();
            return;
            }

        if ((PswNuevo.getText().length()<6 && PswNuevo.getText().length()>20)  || (PswRepiteNuevo.getText().length()<6 && PswRepiteNuevo.getText().length()>20)) {
            javax.swing.JOptionPane.showMessageDialog(this,"El password debe ser por lo menos de 6 carcateres","Cambio Pass",
            javax.swing.JOptionPane.ERROR_MESSAGE);
            PswActual.setText("");
            PswNuevo.setText("");
            PswRepiteNuevo.setText("");
            PswActual.requestFocus();
            return;
        }

        if ("".equals(PswActual.getText().trim()) ) {
            javax.swing.JOptionPane.showMessageDialog(this,"no introdujo el password actual","Cambio Pass",
            javax.swing.JOptionPane.ERROR_MESSAGE);
            PswActual.setText("");
            PswNuevo.setText("");
            PswRepiteNuevo.setText("");
            PswActual.requestFocus();
            return;
        }

    int res = javax.swing.JOptionPane.showConfirmDialog( this,"Â¿Desea guardar los datos?",
                "Cambio Pass",javax.swing.JOptionPane.YES_NO_OPTION );
    if (res == javax.swing.JOptionPane.NO_OPTION) return;
    try {   AdquiWSServiceLocator servicio = new AdquiWSServiceLocator();
            AdquiWS_PortType puerto = servicio.getAdquiWS();
            Map[] datos = puerto.getVerifPassw(cod_usuario,PswActual.getText().trim());
            if (datos!=null){
                datos = puerto.getPasswordUsr("SET-upDaTeUsr", cod_usuario, PswNuevo.getText().trim());
                javax.swing.JOptionPane.showMessageDialog(this,"Password modificado","Cambio pass",
                 javax.swing.JOptionPane.INFORMATION_MESSAGE);
                BtnCancelar.doClick();
            }
            else { javax.swing.JOptionPane.showMessageDialog(this,"El password original no es el mismo","Cambio pass",
                javax.swing.JOptionPane.ERROR_MESSAGE);
                PswActual.setText("");
                PswNuevo.setText("");
                PswRepiteNuevo.setText("");
                PswActual.requestFocus();
            }
        } catch (RemoteException ex) {
            javax.swing.JOptionPane.showMessageDialog(this,"<html> error de conexion con el servidor <br> "+ex,"Cambio pass",
                            javax.swing.JOptionPane.ERROR_MESSAGE);    }
        catch (ServiceException ex) {}
    }//GEN-LAST:event_BtnAceptarActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton BtnAceptar;
    private javax.swing.JButton BtnCancelar;
    private javax.swing.JPasswordField PswActual;
    private javax.swing.JPasswordField PswNuevo;
    private javax.swing.JPasswordField PswRepiteNuevo;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JPanel jPanel1;
    // End of variables declaration//GEN-END:variables

}
